<% @user = User.find(current_user.id) %>

<div class="table-responsive">
    <h1 class="text-center">Your order details.</h1>
    <table class="table">
        <thead>
            <tr class="active">
                <td colspan="2">
                    <h4>Name # <%= @user.name %></h4>
                    <h5>Address # <%= @user.email %></h5>
                </td>
                <td colspan="2">
                    <h5>Order no # <%= @order.id %></h5>
                    <h5>Order Date # <%= @order.order_date %></h5>
                    <h5>Order Status # <%= @order.status %></h5>
                </td>
            </tr>
            <tr class="success">
                <th>Title</th>
                <th>Qty.</th>
                <th>Price</th>
                <th class="text-right">Sub-total</th>
            </tr>
        </thead>
        <tbody>
            <% @total = 0 %>
            <% @orderitems.each do |id,quantity| %>
                <tr>
                    <% item = Orderitem.find_by_id(id) %>
                    <td><%= item.title %></td>
                    <td><%= item.quantity %></td>
                    <td><%= number_to_currency(number_with_precision(item.price, :precision => 2), :unit => "€")%></td> 
                    <td class="text-right"><%= number_to_currency(number_with_precision(item.quantity * item.price, :precision => 2), :unit => "€") %></td>
                    <% timx = (item.quantity * item.price)%>
                    <% @total += timx %>
                 </tr>
            <% end %>
        </tbody>
        <tfoot>
            <tr class="success">
                <td colspan="5" style="text-align:right"> <h3>Total # <%= number_to_currency(number_with_precision(@total, :precision => 2), :unit => "€") %></h3> </td>
            </tr>
            <% if @order.status.eql? "Pending" %>
                <tr class="active">
                    <td colspan="5" style="text-align:center;">
                        <%= render'orders/paypal_link' %>
                        <h4>by Paypal</h4>
                    </td>
                </tr>
            <%end%>
        </tfoot>
    </table>
    <div class="container text-center" style="margin-top:25px;">
        <%= link_to "Back", orders_path, class: 'btn btn-md btn-success',style: 'color: white;' %>
        <% if @order.status.eql? "Pending" %>
            <%= link_to "Edit", edit_order_path(@order), class: 'btn btn-md btn-warning' ,style: 'color: white;'%>
            <%= link_to "Delete", order_path(id: @order.id), method: :delete, data: { confirm: 'Are you sure?' }, class: 'btn btn-md btn-danger',style: 'color: white;' %>
        <%end%>
    </div>
</div>

